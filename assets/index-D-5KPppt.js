import{r as o}from"./index-CaWGgosi.js";import{addToolbarButton as st,isImageSlide as K,PLUGIN_ZOOM as J,createModule as lt,makeUseContext as ut,useLightboxProps as A,useLightboxState as U,useLayoutEffect as z,ImageSlide as j,clsx as dt,cssClass as H,CLASS_SLIDE_WRAPPER_INTERACTIVE as ht,CLASS_SLIDE_WRAPPER as mt,CLASS_FLEX_CENTER as ft,CLASS_FULLSIZE as gt,useController as W,isImageFitCover as nt,useEventCallback as O,devicePixelRatio as pt,round as ot,useDocumentContext as wt,usePointerEvents as vt,cleanup as bt,EVENT_ON_WHEEL as Zt,EVENT_ON_KEY_DOWN as Mt,UNKNOWN_ACTION_TYPE as Ct,IconButton as Et,createIcon as it,useMotionPreference as St}from"./index-Chf3EZGT.js";const xt={minZoom:1,maxZoomPixelRatio:1,zoomInMultiplier:2,doubleTapDelay:300,doubleClickDelay:500,doubleClickMaxStops:2,keyboardMoveDistance:50,wheelZoomDistanceFactor:100,pinchZoomDistanceFactor:100,scrollToZoom:!1};function It(t){return Math.min(Math.max(t,Number.EPSILON),1)}function rt(t){const{minZoom:n,...i}={...xt,...t};return{minZoom:It(n),...i}}function Pt(t,n,i,e){const c=o.useRef(void 0),a=o.useRef(void 0),{zoom:d}=A().animation,s=St(),l=O(()=>{var g,h,u;if((g=c.current)===null||g===void 0||g.cancel(),c.current=void 0,a.current&&(e!=null&&e.current)){try{c.current=(u=(h=e.current).animate)===null||u===void 0?void 0:u.call(h,[{transform:a.current},{transform:`scale(${t}) translateX(${n}px) translateY(${i}px)`}],{duration:s?0:d??500,easing:c.current?"ease-out":"ease-in-out"})}catch(m){console.error(m)}a.current=void 0,c.current&&(c.current.onfinish=()=>{c.current=void 0})}});return z(l,[t,n,i,l]),o.useCallback(()=>{a.current=e!=null&&e.current?window.getComputedStyle(e.current).transform:void 0},[e])}function _t(t,n){const{on:i}=A(),e=O(()=>{var c;n||(c=i.zoom)===null||c===void 0||c.call(i,{zoom:t})});o.useEffect(e,[t,e])}function $(){const{zoom:t}=A();return rt(t)}function kt(t,n){var i,e;let c={width:0,height:0},a={width:0,height:0};const{currentSlide:d}=U(),{imageFit:s}=A().carousel,{maxZoomPixelRatio:l}=$();if(t&&d){const h={...d,...n};if(K(h)){const u=nt(h,s),m=Math.max(...(((i=h.srcSet)===null||i===void 0?void 0:i.map(w=>w.width))||[]).concat(h.width?[h.width]:[])),p=Math.max(...(((e=h.srcSet)===null||e===void 0?void 0:e.map(w=>w.height))||[]).concat(h.height?[h.height]:[]));m>0&&p>0&&t.width>0&&t.height>0&&(a=u?{width:Math.round(Math.min(m,t.width/t.height*p)),height:Math.round(Math.min(p,t.height/t.width*m))}:{width:m,height:p},a={width:a.width*l,height:a.height*l},c=u?{width:Math.min(t.width,a.width,m),height:Math.min(t.height,a.height,p)}:{width:Math.round(Math.min(t.width,t.height/p*m,m)),height:Math.round(Math.min(t.height,t.width/m*p,p))})}}const g=c.width?Math.max(ot(a.width/c.width,5),1):1;return{imageRect:c,maxZoom:g}}function Q(t,n){return((t.clientX-n.clientX)**2+(t.clientY-n.clientY)**2)**.5}function tt(t,n,i=100,e=2){return t*Math.min(1+Math.abs(n/i),e)**Math.sign(n)}function Dt(t,n,i,e,c,a,d,s,l){const g=o.useRef([]),h=o.useRef(0),u=o.useRef(void 0),{globalIndex:m}=U(),{getOwnerWindow:p}=wt(),{containerRef:w,subscribeSensors:v}=W(),{keyboardMoveDistance:M,zoomInMultiplier:E,wheelZoomDistanceFactor:I,scrollToZoom:b,doubleTapDelay:L,doubleClickDelay:S,doubleClickMaxStops:y,pinchZoomDistanceFactor:Z}=$(),F=o.useCallback(r=>{if(w.current){const{pageX:f,pageY:C}=r,{scrollX:P,scrollY:k}=p(),{left:D,top:Y,width:N,height:R}=w.current.getBoundingClientRect();return[f-D-P-N/2,C-Y-k-R/2]}return[]},[w,p]),T=O(r=>{const{key:f,metaKey:C,ctrlKey:P}=r,k=C||P,D=()=>{r.preventDefault(),r.stopPropagation()};if(t>1){const Y=(N,R)=>{D(),s(N,R)};f==="ArrowDown"?Y(0,M):f==="ArrowUp"?Y(0,-M):f==="ArrowLeft"?Y(-M,0):f==="ArrowRight"&&Y(M,0)}f==="+"||k&&f==="="?(D(),c()):f==="-"||k&&f==="_"?(D(),a()):k&&f==="0"&&(D(),d(1))}),_=O(r=>{if((r.ctrlKey||b)&&Math.abs(r.deltaY)>Math.abs(r.deltaX)){r.stopPropagation(),d(tt(t,-r.deltaY,I),!0,...F(r));return}t>1&&(r.stopPropagation(),b||s(r.deltaX,r.deltaY))}),x=o.useCallback(r=>{const f=g.current;f.splice(0,f.length,...f.filter(C=>C.pointerId!==r.pointerId))},[]),X=o.useCallback(r=>{x(r),r.persist(),g.current.push(r)},[x]),V=O(r=>{var f;const C=g.current;if(r.pointerType==="mouse"&&r.buttons>1||!(!((f=l==null?void 0:l.current)===null||f===void 0)&&f.contains(r.target)))return;t>1&&r.stopPropagation();const{timeStamp:P}=r;if(C.length===0&&P-h.current<(r.pointerType==="touch"?L:S)){h.current=0;const k=t>=1?t!==i?t*Math.max(i**(1/y),E):1:t!==n?t/Math.max(n**(-1/y),E):1;d(k,!1,...F(r))}else h.current=P;X(r),C.length===2&&(u.current=Q(C[0],C[1]))}),G=O(r=>{const f=g.current,C=f.find(P=>P.pointerId===r.pointerId);if(f.length===2&&u.current){r.stopPropagation(),X(r);const P=Q(f[0],f[1]),k=P-u.current;Math.abs(k)>0&&(d(tt(t,k,Z),!0,...f.map(D=>F(D)).reduce((D,Y)=>Y.map((N,R)=>D[R]+N/2))),u.current=P);return}t>1&&(r.stopPropagation(),C&&(f.length===1&&s((C.clientX-r.clientX)/t,(C.clientY-r.clientY)/t),X(r)))}),at=o.useCallback(r=>{const f=g.current;f.length===2&&f.find(C=>C.pointerId===r.pointerId)&&(u.current=void 0),x(r)},[x]),B=o.useCallback(()=>{const r=g.current;r.splice(0,r.length),h.current=0,u.current=void 0},[]);vt(v,V,G,at,e),o.useEffect(B,[m,B]),o.useEffect(()=>e?()=>{}:bt(B,v(Mt,T),v(Zt,_)),[e,v,B,T,_])}function yt(t,n,i){const[e,c]=o.useState(1),[a,d]=o.useState(0),[s,l]=o.useState(0),g=Pt(e,a,s,i),{currentSlide:h,globalIndex:u}=U(),{containerRect:m,slideRect:p}=W(),{minZoom:w,zoomInMultiplier:v}=$(),M=h&&K(h)?h.src:void 0,E=!M||!(i!=null&&i.current);z(()=>{c(1),d(0),l(0)},[u,M]);const I=o.useCallback((Z,F,T)=>{const _=T||e,x=a-(Z||0),X=s-(F||0),V=(t.width*_-p.width)/2/_,G=(t.height*_-p.height)/2/_;d(Math.min(Math.abs(x),Math.max(V,0))*Math.sign(x)),l(Math.min(Math.abs(X),Math.max(G,0))*Math.sign(X))},[e,a,s,p,t.width,t.height]),b=o.useCallback((Z,F,T,_)=>{const x=ot(Math.min(Math.max(Z+.001<n?Z:n,w),n),5);x!==e&&(F||g(),I(T?T*(1/e-1/x):0,_?_*(1/e-1/x):0,x),c(x))},[e,w,n,I,g]),L=O(()=>{e>1&&(e>n&&b(n,!0),I())});z(L,[m.width,m.height,L]);const S=o.useCallback(()=>{const Z=e*v;b(e<1&&Z>1?1:Z)},[e,v,b]),y=o.useCallback(()=>{const Z=e/v;b(e>1&&Z<1?1:Z)},[e,v,b]);return{zoom:e,offsetX:a,offsetY:s,disabled:E,changeOffsets:I,changeZoom:b,zoomIn:S,zoomOut:y}}const ct=o.createContext(null),q=ut("useZoom","ZoomControllerContext",ct);function Ot({children:t}){const[n,i]=o.useState(),{slideRect:e}=W(),{ref:c,minZoom:a}=$(),{imageRect:d,maxZoom:s}=kt(e,n==null?void 0:n.imageDimensions),{zoom:l,offsetX:g,offsetY:h,disabled:u,changeZoom:m,changeOffsets:p,zoomIn:w,zoomOut:v}=yt(d,s,n==null?void 0:n.zoomWrapperRef);_t(l,u),Dt(l,a,s,u,w,v,m,p,n==null?void 0:n.zoomWrapperRef);const M=o.useMemo(()=>({zoom:l,minZoom:a,maxZoom:s,offsetX:g,offsetY:h,disabled:u,zoomIn:w,zoomOut:v,changeZoom:m}),[l,a,s,g,h,u,w,v,m]);o.useImperativeHandle(c,()=>M,[M]);const E=o.useMemo(()=>({...M,setZoomWrapper:i}),[M,i]);return o.createElement(ct.Provider,{value:E},t)}const Lt=it("ZoomIn",o.createElement(o.Fragment,null,o.createElement("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),o.createElement("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"}))),Yt=it("ZoomOut",o.createElement("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14zM7 9h5v1H7z"})),et=o.forwardRef(function({zoomIn:n,onLoseFocus:i},e){const c=o.useRef(!1),a=o.useRef(!1),{zoom:d,minZoom:s,maxZoom:l,zoomIn:g,zoomOut:h,disabled:u}=q(),{render:m}=A(),p=u||(n?d>=l:d<=s);return o.useEffect(()=>{p&&c.current&&a.current&&i(),p||(c.current=!0)},[p,i]),o.createElement(Et,{ref:e,disabled:p,label:n?"Zoom in":"Zoom out",icon:n?Lt:Yt,renderIcon:n?m.iconZoomIn:m.iconZoomOut,onClick:n?g:h,onFocus:()=>{a.current=!0},onBlur:()=>{a.current=!1}})});function Ft(){const t=o.useRef(null),n=o.useRef(null),{focus:i}=W(),e=o.useCallback(d=>{var s,l;!((s=d.current)===null||s===void 0)&&s.disabled?i():(l=d.current)===null||l===void 0||l.focus()},[i]),c=o.useCallback(()=>e(t),[e]),a=o.useCallback(()=>e(n),[e]);return o.createElement(o.Fragment,null,o.createElement(et,{zoomIn:!0,ref:t,onLoseFocus:a}),o.createElement(et,{ref:n,onLoseFocus:c}))}function Tt(){const{render:t}=A(),n=q();return t.buttonZoom?o.createElement(o.Fragment,null,t.buttonZoom(n)):o.createElement(Ft,null)}function At(t){var n;return(((n=t.srcSet)===null||n===void 0?void 0:n.length)||0)>0}function Xt({current:t,preload:n},{type:i,source:e}){switch(i){case"fetch":return t?{current:t,preload:e}:{current:e};case"done":return e===n?{current:e}:{current:t,preload:n};default:throw new Error(Ct)}}function Nt(t){var n,i;const[{current:e,preload:c},a]=o.useReducer(Xt,{}),{slide:d,rect:s,imageFit:l,render:g,interactive:h}=t,u=d.srcSet.sort((S,y)=>S.width-y.width),m=(n=d.width)!==null&&n!==void 0?n:u[u.length-1].width,p=(i=d.height)!==null&&i!==void 0?i:u[u.length-1].height,w=nt(d,l),v=Math.max(...u.map(S=>S.width)),M=Math.min((w?Math.max:Math.min)(s.width,m*(s.height/p)),v),E=pt(),I=O(()=>{var S;const y=(S=u.find(Z=>Z.width>=M*E))!==null&&S!==void 0?S:u[u.length-1];(!e||u.findIndex(Z=>Z.src===e)<u.findIndex(Z=>Z===y))&&a({type:"fetch",source:y.src})});z(I,[s.width,s.height,E,I]);const b=O(S=>a({type:"done",source:S})),L={WebkitTransform:h?"initial":"translateZ(0)"};return w||Object.assign(L,s.width/s.height<m/p?{width:"100%",height:"auto"}:{width:"auto",height:"100%"}),o.createElement(o.Fragment,null,c&&c!==e&&o.createElement(j,{key:"preload",...t,offset:void 0,slide:{...d,src:c,srcSet:void 0},style:{position:"absolute",visibility:"hidden",...L},onLoad:()=>b(c),render:{...g,iconLoading:()=>null,iconError:()=>null}}),e&&o.createElement(j,{key:"current",...t,slide:{...d,src:e,srcSet:void 0},style:L}))}function Rt({render:t,slide:n,offset:i,rect:e}){var c;const[a,d]=o.useState(),s=o.useRef(null),{zoom:l,maxZoom:g,offsetX:h,offsetY:u,setZoomWrapper:m}=q(),p=l>1,{carousel:w,on:v}=A(),{currentIndex:M}=U();z(()=>i===0?(m({zoomWrapperRef:s,imageDimensions:a}),()=>m(void 0)):()=>{},[i,a,m]);let E=(c=t.slide)===null||c===void 0?void 0:c.call(t,{slide:n,offset:i,rect:e,zoom:l,maxZoom:g});if(!E&&K(n)){const I={slide:n,offset:i,rect:e,render:t,imageFit:w.imageFit,imageProps:w.imageProps,onClick:i===0?()=>{var b;return(b=v.click)===null||b===void 0?void 0:b.call(v,{index:M})}:void 0};E=At(n)?o.createElement(Nt,{...I,slide:n,interactive:p,rect:i===0?{width:e.width*l,height:e.height*l}:e}):o.createElement(j,{onLoad:b=>d({width:b.naturalWidth,height:b.naturalHeight}),...I})}return E?o.createElement("div",{ref:s,className:dt(H(gt),H(ft),H(mt),p&&H(ht)),style:i===0?{transform:`scale(${l}) translateX(${h}px) translateY(${u}px)`}:void 0},E):null}const Ht=({augment:t,addModule:n})=>{t(({zoom:i,toolbar:e,render:c,controller:a,...d})=>{const s=rt(i);return{zoom:s,toolbar:st(e,J,o.createElement(Tt,null)),render:{...c,slide:l=>{var g;return K(l.slide)?o.createElement(Rt,{render:c,...l}):(g=c.slide)===null||g===void 0?void 0:g.call(c,l)}},controller:{...a,preventDefaultWheelY:s.scrollToZoom},...d}}),n(lt(J,Ot))};export{Ht as default};
